<html lang="en">

<head>
  <title>Select the restaurant of your dreams</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>

	<script type="text/javascript" src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
	<script type="text/javascript" src="https://code.jquery.com/ui/1.11.0/jquery-ui.min.js"></script>
	<link rel="stylesheet" media="all" type="text/css" href="https://code.jquery.com/ui/1.11.0/themes/smoothness/jquery-ui.css" />

	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-ui-timepicker-addon/1.6.3/jquery-ui-timepicker-addon.js"></script>
  <link rel="stylesheet" media="all" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-ui-timepicker-addon/1.6.3/jquery-ui-timepicker-addon.css" />

  <h2>Select the restaurant of your dreams...</h2>

  
  <script>
  "use strict";
  $(
    function() {
     var datepicker = $( "#datepicker_id" );
     var restaurant_time_ranges; // propagated later
     datepicker.datetimepicker( {
       stepMinute: 15,
       onSelect: function (selectedDateTime){
         // if they change day or anything this is triggered (i.e. even early)...
          var date = datepicker.datetimepicker('getDate');
          new_date_input_selected(date);
         }
     });
     
     $.getJSON("rest_hours.json", function(data){
       restaurant_time_ranges = parse_all_restaurants(data);
     });
    }
   );
   
   function parse_all_restaurants(data) {
     // data is ["name": "Bai Thong Thai Cuisine", "times": ["Mon-Sat 11 am - 11 pm", "Sun 11 am - 10 pm"] ...]
     // desired output: [ranges: [[day_of_week, start_minute, end_minute], ... ]
     var output = [];
     for(var i=0; i < data.length; i++){
       output.push(parse_single_restaurant_to_ranges(data[i]));
     }
   
     // TODO add divs for them
   }
   
   function parse_single_restaurant_to_ranges(restaurant) {
     var output = [];
     var day_ranges = restaurant.times;
     for(var i=0; i < day_ranges.length; i++){
       var day_range = day_ranges[i];
       output.push(parse_single_range(day_range)); // XXXX can it push on multiples?
     }
   }
   
   function parse_single_range(day_range) {
      // day_range: 
      // "Sun 11 am - 10:30 pm"
      // "Mon-Thu, Sun 10 am - 10:30 pm"      
      // "Mon-Sat 11 am - 11 pm"
      var whereNumbersStart = day_range.search(/\d/); // only want to split it in 2
      var days = day_range.substring(0, whereNumbersStart - 1); // Mon-Thu, Sun
      var times = day_range.substring(whereNumbersStart); // 10 am - 10:30 pm (always a single dash, phew)
      var start = timeToMinutes(times.split(" - ")[0]);
      var end = timeToMinutes(times.split(" - ")[1]);
      // TODO accomodate wrapping
      
      return [{day: stringToIntWeekDay(days), start: start, end: end}];
   }
   
   function timeToMinutes(time) {
     // like 10:30 pm or 10 am
     var minutes = 0;
     if (time.include(":")) {
       
     }
    
   }
   
   function stringToIntWeekDay(day) {
     return ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"].indexOf(day); // javascript doesn't seem to have a lightweight way to do this :|
   }
   
   function new_date_input_selected(date) {
     var day_of_week = date.getDay(); // day of the week (0 is sunday)
     // TODO ...
   }
   
   function assert_range_parses(time_range, expected) {
     var parsed = parse_single_range(time_range);
     console.assert(parsed == expected, {"message": "parsed wrong", "parsed": parsed, "expected": expected});
   }
   
   function do_unit_tests() {
     assert_range_parses("Mon 11 am - 11 pm", [{day: 1, start: (11*60), end: (23*60)}])
   }
   
   do_unit_tests();
   
  </script>

  <p>Date: <input type="text" id="datepicker_id"></p>


</body>

</html>